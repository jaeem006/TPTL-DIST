\begin{code}

open import Agda.Builtin.Equality

open import Data.Product
open import Data.Sum
open import Data.Empty
open import Relation.Binary.PropositionalEquality using (sym ; trans ; subst)

open import World

module WorldUtil (W : World)
       where

open World.World W

_â‰º_ : ğ• â†’ ğ• â†’ Set
wâ‚ â‰º wâ‚‚ = Î£ ğ• (Î» w â†’ Î£ ğ• (Î» wâ€² â†’ wâ‚ â‰¼ w Ã— (w â—ƒ wâ€²) Ã— wâ€² â‰¼ wâ‚‚))

â‰ºâ†’â‰¼ : {wâ‚ wâ‚‚ : ğ•} â†’ wâ‚ â‰º wâ‚‚ â†’ wâ‚ â‰¼ wâ‚‚
â‰ºâ†’â‰¼ {wâ‚} {wâ‚‚} (w , wâ€² , câ‚ , câ‚‚ , câ‚ƒ) = â‰¼-trans câ‚ (â‰¼-trans (â—ƒâ†’â‰¼ câ‚‚) câ‚ƒ)

â—ƒâ†’â‰º : {wâ‚ wâ‚‚ : ğ•} â†’ wâ‚ â—ƒ wâ‚‚ â†’ wâ‚ â‰º wâ‚‚
â—ƒâ†’â‰º {wâ‚} {wâ‚‚} h = wâ‚ , wâ‚‚ , â‰¼-refl , h , â‰¼-refl

â‰º-â‰¼-trans : {wâ‚ wâ‚‚ wâ‚ƒ : ğ•} â†’ wâ‚ â‰º wâ‚‚ â†’ wâ‚‚ â‰¼ wâ‚ƒ â†’ wâ‚ â‰º wâ‚ƒ
â‰º-â‰¼-trans {wâ‚} {wâ‚‚} {wâ‚ƒ} (w , wâ€² , câ‚ , câ‚‚ , câ‚ƒ) q = w , wâ€² , câ‚ , câ‚‚ , â‰¼-trans câ‚ƒ q

â‰¼-â‰º-trans : {wâ‚ wâ‚‚ wâ‚ƒ : ğ•} â†’ wâ‚ â‰¼ wâ‚‚ â†’ wâ‚‚ â‰º wâ‚ƒ â†’ wâ‚ â‰º wâ‚ƒ
â‰¼-â‰º-trans {wâ‚} {wâ‚‚} {wâ‚ƒ} h (w , wâ€² , câ‚ , câ‚‚ , câ‚ƒ) = w , wâ€² , â‰¼-trans h câ‚ , câ‚‚ , câ‚ƒ

â‰º-trans : {wâ‚ wâ‚‚ wâ‚ƒ : ğ•} â†’ wâ‚ â‰º wâ‚‚ â†’ wâ‚‚ â‰º wâ‚ƒ â†’ wâ‚ â‰º wâ‚ƒ
â‰º-trans {wâ‚} {wâ‚‚} {wâ‚ƒ} (w , wâ€² , câ‚ , câ‚‚ , câ‚ƒ) q =
  w , wâ€² , câ‚ , câ‚‚ , â‰¼-trans câ‚ƒ (â‰ºâ†’â‰¼ q)

â‰ºâ‡’â—ƒáµ£ : (wâ‚ wâ‚‚ : ğ•) â†’ wâ‚ â‰º wâ‚‚ â†’ Î£ ğ• (Î» w â†’ wâ‚ â‰¼ w Ã— (w â—ƒ wâ‚‚))
â‰ºâ‡’â—ƒáµ£ wâ‚ wâ‚‚ (w , wâ€² , câ‚ , câ‚‚ , câ‚ƒ) with â‰¼â†’â‰¡âŠâ—ƒáµ£ câ‚ƒ
... | injâ‚ refl = w , câ‚ , câ‚‚
... | injâ‚‚ (wâ€³ , dâ‚ , dâ‚‚) = wâ€³ , â‰¼-trans câ‚ (â‰¼-trans (â—ƒâ†’â‰¼ câ‚‚) dâ‚) , dâ‚‚

{--
â‰ºâ‡’â—ƒâ‚— : (wâ‚ wâ‚‚ : ğ•) â†’ wâ‚ â‰º wâ‚‚ â†’ Î£ ğ• (Î» w â†’ wâ‚ â—ƒ w Ã— (w â‰¼ wâ‚‚))
â‰ºâ‡’â—ƒâ‚— wâ‚ wâ‚‚ (w , wâ€² , câ‚ , câ‚‚ , câ‚ƒ) with â‰¼â†’â‰¡âŠâ—ƒâ‚— câ‚
... | injâ‚ refl = wâ€² , câ‚‚ , câ‚ƒ
... | injâ‚‚ (wâ€³ , dâ‚ , dâ‚‚) = wâ€³ , dâ‚ , â‰¼-trans dâ‚‚ (â‰¼-trans (â—ƒâ†’â‰¼ câ‚‚) câ‚ƒ)
--}

Â·-right-id : (w : ğ•) â†’ w Â· ğŸ˜ â‰¡ w
Â·-right-id w = subst (Î» x â†’ x â‰¡ w) (Â·-sym ğŸ˜ w) Â·-left-id

Â·-cong-â‰¼-râ‚ : (wâ‚ wâ‚‚ wâ‚ƒ : ğ•) â†’ wâ‚ â‰¼ wâ‚‚ â†’ wâ‚ â‰¼ wâ‚‚ Â· wâ‚ƒ
Â·-cong-â‰¼-râ‚ wâ‚ wâ‚‚ wâ‚ƒ â‰¼â‚ = subst (Î» x â†’ x â‰¼ wâ‚‚ Â· wâ‚ƒ) (Â·-right-id wâ‚) (Â·-cong-â‰¼ â‰¼â‚ ğŸ˜â‰¼)

Â·-cong-â‰¼-râ‚‚ : (wâ‚ wâ‚‚ wâ‚ƒ : ğ•) â†’ wâ‚ â‰¼ wâ‚‚ â†’ wâ‚ â‰¼ wâ‚ƒ Â· wâ‚‚
Â·-cong-â‰¼-râ‚‚ wâ‚ wâ‚‚ wâ‚ƒ â‰¼â‚ = subst (Î» x â†’ wâ‚ â‰¼ x) (Â·-sym wâ‚‚ wâ‚ƒ) (Â·-cong-â‰¼-râ‚ wâ‚ wâ‚‚ wâ‚ƒ â‰¼â‚)

ğŸ˜âŠâ—ƒ : (w : ğ•) â†’ w â‰¡ ğŸ˜ âŠ Î£ ğ• (Î» wâ€² â†’ wâ€² â—ƒ w)
ğŸ˜âŠâ—ƒ w with â‰¼â†’â‰¡âŠâ—ƒáµ£ {ğŸ˜} {w} ğŸ˜â‰¼
... | injâ‚ refl = injâ‚ refl
... | injâ‚‚ (wâ€² , câ‚ , câ‚‚) = injâ‚‚ (wâ€² , câ‚‚)

{--
â—ƒâˆ§â‰ºâ†’â‰¼ : {wâ‚ wâ‚‚ wâ‚ƒ : ğ•} â†’ wâ‚ â—ƒ wâ‚‚ â†’ wâ‚ â‰º wâ‚ƒ â†’ wâ‚‚ â‰¼ wâ‚ƒ
â—ƒâˆ§â‰ºâ†’â‰¼ {wâ‚} {wâ‚‚} {wâ‚ƒ} h q with â‰ºâ‡’â—ƒâ‚— wâ‚ wâ‚ƒ q
... | w , dâ‚ , dâ‚‚ with â—ƒinjáµ£ h dâ‚
... | refl = dâ‚‚
--}

â‰¼âŠâ‰º : {wâ‚ wâ‚‚ w : ğ•} â†’ wâ‚ â‰¼ w â†’ wâ‚‚ â‰¼ w â†’ wâ‚ â‰¼ wâ‚‚ âŠ wâ‚‚ â‰º wâ‚
â‰¼âŠâ‰º {wâ‚} {wâ‚‚} {w} h q with â‰¼âŠâ‰¼ h q
... | injâ‚ p = injâ‚ p
... | injâ‚‚ p with â‰¼â†’â‰¡âŠâ—ƒáµ£ p
... |   injâ‚ refl = injâ‚ â‰¼-refl
... |   injâ‚‚ (wâ€² , câ‚ , câ‚‚) = injâ‚‚ (wâ€² , wâ‚ , câ‚ , câ‚‚ , â‰¼-refl)

{--
â‰¼ğŸ˜ : {w : ğ•} â†’ w â‰¼ ğŸ˜ â†’ w â‰¡ ğŸ˜
â‰¼ğŸ˜ {w} h with â‰¼â†’â‰¡âŠâ—ƒáµ£ {w} {ğŸ˜} h
... | injâ‚ p = p
... | injâ‚‚ (x , câ‚ , câ‚‚) = âŠ¥-elim (Â¬â—ƒğŸ˜ câ‚‚)
--}

totality : {wâ‚ wâ‚‚ : ğ•} â†’ wâ‚ â‰¼ wâ‚‚ âŠ wâ‚‚ â‰¼ wâ‚
totality {wâ‚} {wâ‚‚} =
  â‰¼âŠâ‰¼ {wâ‚} {wâ‚‚} {wâ‚ Â· wâ‚‚}
      (Â·-cong-â‰¼-râ‚ wâ‚ wâ‚ wâ‚‚ â‰¼-refl)
      (Â·-cong-â‰¼-râ‚‚ wâ‚‚ wâ‚‚ wâ‚ â‰¼-refl)

\end{code}
